<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Retrieving Destatis data • RUBer</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Retrieving Destatis data">
<meta property="og:description" content="RUBer">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">RUBer</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/reference_docx.html">Formatting for the reference docx document</a>
    </li>
    <li>
      <a href="../articles/RUB_colors.html">Using RUB colors</a>
    </li>
    <li>
      <a href="../articles/RUB_plot.html">Using the RUB plotting functions</a>
    </li>
    <li>
      <a href="../articles/wiesbaden.html">Retrieving Destatis data</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/RichardMeyer-Eppler/RUBer/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="wiesbaden_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Retrieving Destatis data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/RichardMeyer-Eppler/RUBer/blob/master/vignettes/wiesbaden.Rmd"><code>vignettes/wiesbaden.Rmd</code></a></small>
      <div class="hidden name"><code>wiesbaden.Rmd</code></div>

    </div>

    
    
<p>This vignette will explain step-by-step how to retrieve entire table series and their associated labels from Destatis using the package <code>wiesbaden</code>. My aim with the approach described here is to make it easily adaptable to other use cases or table series. Feedback welcome!</p>
<div id="wiesbaden-setup" class="section level1">
<h1 class="hasAnchor">
<a href="#wiesbaden-setup" class="anchor"></a>Wiesbaden Setup</h1>
<p>First off, load the packages we will be using throughout this vignette.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">extrafont</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">forcats</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">httptest</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">janitor</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">purrr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">RUBer</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tibble</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyselect</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">wiesbaden</span>)</pre></body></html></div>
<p>The R package <code>wiesbaden</code> by Moritz Marbach provides functions to directly retrieve data from databases maintained by the Federal Statistical Office of Germany (Destatis) in Wiesbaden. After installing the package with <code><a href="https://remotes.r-lib.org/reference/install_github.html">remotes::install_github("sumtxt/wiesbaden")</a></code>, you can check <code>vignette("using-wiesbaden", package = "wiesbaden")</code> for more info.</p>
<p>In order to retrieve data from the four available databases (<a href="https://www.bildungsmonitoring.de">Bildungsmonitoring</a>, <a href="https://www-genesis.destatis.de/genesis/online">Genesis</a>, <a href="https://www.landesdatenbank.nrw.de">Landesdatenbank NRW</a>, <a href="https://www.regionalstatistik.de/genesis/online">Regionalstatistik</a>), you need to register on the respective website. For this vignette, we use the Landesdatenbank NRW database, so please register an account there. Once you have registered, use <code><a href="https://rdrr.io/pkg/wiesbaden/man/save_credentials.html">wiesbaden::save_credentials</a></code> to save your login information and <code><a href="https://rdrr.io/pkg/wiesbaden/man/test_login.html">wiesbaden::test_login</a></code> to test the connection. If you cannot establish a valid connection, you will not be able to execute all subsequent code chunks!</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="co"># Save your credentials for the Landesdatenbank NRW</span>
<span class="kw pkg">wiesbaden</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/wiesbaden/man/save_credentials.html">save_credentials</a></span>(
  <span class="kw">db</span> <span class="kw">=</span> <span class="st">"nrw"</span>,                        <span class="co"># Do not change</span>
  <span class="kw">user</span> <span class="kw">=</span> <span class="st">"YOUR USER NAME"</span>,           <span class="co"># Update with your account name</span>
  <span class="kw">password</span> <span class="kw">=</span> <span class="st">"YOUR PASSWORD"</span>         <span class="co"># Update with your password </span>
)

<span class="co"># Test connection</span>
<span class="kw pkg">wiesbaden</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/wiesbaden/man/test_login.html">test_login</a></span>(
   <span class="kw">genesis</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">db</span> <span class="kw">=</span> <span class="st">"nrw"</span>)
   )</pre></body></html></div>
</div>
<div id="retrieving-data" class="section level1">
<h1 class="hasAnchor">
<a href="#retrieving-data" class="anchor"></a>Retrieving Data</h1>
<p>In this vignette, we are interested in tables with data on universities. On the Landesdatenbank NRW website, the code for tables on universities is “213”. So let us retrieve all table names with code “213” and turn the resulting data frame into a tibble for prettier printing.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="co"># Retrieve all tables with code "213" and turn data frame into tibble</span>
<span class="no">df_table</span> <span class="kw">&lt;-</span> <span class="kw pkg">wiesbaden</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/wiesbaden/man/retrieve_datalist.html">retrieve_datalist</a></span>(
   <span class="kw">tableseries</span><span class="kw">=</span> <span class="st">"21311*"</span>,
   <span class="kw">genesis</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">db</span> <span class="kw">=</span> <span class="st">"nrw"</span>)
   ) <span class="kw">%&gt;%</span>
  <span class="kw pkg">tibble</span><span class="kw ns">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span>()

<span class="no">df_table</span>
<span class="co">#&gt; # A tibble: 25 x 2</span>
<span class="co">#&gt;    tablename   description                                                      </span>
<span class="co">#&gt;    &lt;chr&gt;       &lt;chr&gt;                                                            </span>
<span class="co">#&gt;  1 21311LS001A Studierende / Studenten, Land, Hochschulen, Studienfach, Fachsem~</span>
<span class="co">#&gt;  2 21311LS002A Studierende / Studenten, Land, Hochschulen, Studienfach, Hochsch~</span>
<span class="co">#&gt;  3 21311NW001A Studierende / Studenten, Land, Hochschulen, Fachsemester, Geschl~</span>
<span class="co">#&gt;  4 21311NW001B Studierende / Studenten, Land, Hochschulen, Fachsemester, Nation~</span>
<span class="co">#&gt;  5 21311NW002A Studierende / Studenten, Land, Hochschulen, Fachsemester, Geschl~</span>
<span class="co">#&gt;  6 21311NW002B Studierende / Studenten, Land, Hochschulen, Fachsemester, Nation~</span>
<span class="co">#&gt;  7 21311NW002C Studierende / Studenten, Land, Fachsemester, Nationalität, Gesch~</span>
<span class="co">#&gt;  8 21311NW003A Studierende / Studenten, Land, Hochschulen, Geschlecht, Hörersta~</span>
<span class="co">#&gt;  9 21311NW003B Studierende / Studenten, Land, Hochschulen, Nationalität, Hörers~</span>
<span class="co">#&gt; 10 21311NW004A Studierende / Studenten, Land, Studienfach, Geschlecht, Hörersta~</span>
<span class="co">#&gt; # ... with 15 more rows</span></pre></body></html></div>
<p>We now have a data frame with the names and descriptions of 37 tables with data on universities in NRW. In the next step, we are going to create a named vector of these table names using <code><a href="https://purrr.tidyverse.org/reference/set_names.html">purrr::set_names</a></code>. We then download the data for all table names in this vector and put them in one big data frame using a combination of <code><a href="https://purrr.tidyverse.org/reference/map.html">purrr::map_dfr</a></code> and <code><a href="https://rdrr.io/pkg/wiesbaden/man/retrieve_data.html">wiesbaden::retrieve_data</a></code>. You will be downloading a lot of data, so this step may take a while!</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="co"># Get all table names and turn them into a named vector</span>
<span class="no">table_names</span> <span class="kw">&lt;-</span> <span class="kw pkg">purrr</span><span class="kw ns">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/set_names.html">set_names</a></span>(
  <span class="kw">x</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(
    <span class="no">df_table</span><span class="kw">[[</span><span class="st">"tablename"</span>]]
  ),
  <span class="kw">nm</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(
      <span class="no">df_table</span><span class="kw">[[</span><span class="st">"tablename"</span>]]
      )
  )

<span class="no">table_names</span>
<span class="co">#&gt;   21311LS001A   21311LS002A   21311NW001A   21311NW001B   21311NW002A </span>
<span class="co">#&gt; "21311LS001A" "21311LS002A" "21311NW001A" "21311NW001B" "21311NW002A" </span>
<span class="co">#&gt;   21311NW002B   21311NW002C   21311NW003A   21311NW003B   21311NW004A </span>
<span class="co">#&gt; "21311NW002B" "21311NW002C" "21311NW003A" "21311NW003B" "21311NW004A" </span>
<span class="co">#&gt;   21311NW004B   21311NW005A   21311NW005B   21311NW006A   21311NW006B </span>
<span class="co">#&gt; "21311NW004B" "21311NW005A" "21311NW005B" "21311NW006A" "21311NW006B" </span>
<span class="co">#&gt;   21311NW007A   21311NW007B    21311NW008    21311NW009    21311NW010 </span>
<span class="co">#&gt; "21311NW007A" "21311NW007B"  "21311NW008"  "21311NW009"  "21311NW010" </span>
<span class="co">#&gt;    21311NW011    21311NW012    21311NW013    21311NW014    21311NW015 </span>
<span class="co">#&gt;  "21311NW011"  "21311NW012"  "21311NW013"  "21311NW014"  "21311NW015"</span>

<span class="co"># Retrieve data for every table name and bind them into one data frame. Note</span>
<span class="co"># that this may take a while!</span>
<span class="no">df</span> <span class="kw">&lt;-</span> <span class="kw pkg">purrr</span><span class="kw ns">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span>(
  <span class="no">table_names</span>,
  <span class="kw pkg">wiesbaden</span><span class="kw ns">::</span><span class="no"><a href="https://rdrr.io/pkg/wiesbaden/man/retrieve_data.html">retrieve_data</a></span>,
  <span class="kw">genesis</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">db</span> <span class="kw">=</span> <span class="st">"nrw"</span>),
  <span class="kw">.id</span> <span class="kw">=</span> <span class="st">"tablename"</span>
  ) <span class="kw">%&gt;%</span>
  <span class="kw pkg">tibble</span><span class="kw ns">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span>()

<span class="no">df</span>
<span class="co">#&gt; # A tibble: 3,632,429 x 20</span>
<span class="co">#&gt;    tablename id21311 DLAND BILHS1 BILSF1 BILFS1 BILAP1 SEMEST BIL002_val</span>
<span class="co">#&gt;    &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;       &lt;dbl&gt;</span>
<span class="co">#&gt;  1 21311LS0~ D       05    HS0034 SF054  FACHS~ AP84   WS 20~         40</span>
<span class="co">#&gt;  2 21311LS0~ D       05    HS0034 SF054  FACHS~ AP84   WS 20~         36</span>
<span class="co">#&gt;  3 21311LS0~ D       05    HS0034 SF054  FACHS~ AP84   WS 20~         35</span>
<span class="co">#&gt;  4 21311LS0~ D       05    HS0034 SF054  FACHS~ AP84   WS 20~         24</span>
<span class="co">#&gt;  5 21311LS0~ D       05    HS0034 SF054  FACHS~ AP84   WS 20~          2</span>
<span class="co">#&gt;  6 21311LS0~ D       05    HS0034 SF069  FACHS~ AP84   WS 20~         18</span>
<span class="co">#&gt;  7 21311LS0~ D       05    HS0034 SF069  FACHS~ AP84   WS 20~         14</span>
<span class="co">#&gt;  8 21311LS0~ D       05    HS0034 SF069  FACHS~ AP84   WS 20~         13</span>
<span class="co">#&gt;  9 21311LS0~ D       05    HS0034 SF069  FACHS~ AP84   WS 20~          7</span>
<span class="co">#&gt; 10 21311LS0~ D       05    HS0034 SF182  FACHS~ AP84   WS 20~         15</span>
<span class="co">#&gt; # ... with 3,632,419 more rows, and 11 more variables: BIL002_qual &lt;chr&gt;,</span>
<span class="co">#&gt; #   BIL002_lock &lt;lgl&gt;, BIL002_err &lt;dbl&gt;, BILSH1 &lt;chr&gt;, GES &lt;chr&gt;, BILHN1 &lt;chr&gt;,</span>
<span class="co">#&gt; #   NAT &lt;chr&gt;, BIL016_val &lt;dbl&gt;, BIL016_qual &lt;chr&gt;, BIL016_lock &lt;lgl&gt;,</span>
<span class="co">#&gt; #   BIL016_err &lt;dbl&gt;</span></pre></body></html></div>
<p>For each table, we now download the available metadata with <code><a href="https://rdrr.io/pkg/wiesbaden/man/retrieve_metadata.html">wiesbaden::retrieve_metadata</a></code> and put them into one data frame using <code><a href="https://purrr.tidyverse.org/reference/map.html">purrr::map_dfr</a></code>. The metadata describes the different variables used in each table. The metadata consists of four columns: tablename, (variable) name, (variable) description and (variable) unit. We then create a character vector of the unique variable names for all tables.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="co"># Retrieve metadata for every table name and bind them into one data frame</span>
<span class="no">df_metadata</span> <span class="kw">&lt;-</span> <span class="kw pkg">purrr</span><span class="kw ns">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span>(
  <span class="no">table_names</span>,
  <span class="kw pkg">wiesbaden</span><span class="kw ns">::</span><span class="no"><a href="https://rdrr.io/pkg/wiesbaden/man/retrieve_metadata.html">retrieve_metadata</a></span>,
  <span class="kw">genesis</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">db</span> <span class="kw">=</span> <span class="st">"nrw"</span>),
  <span class="kw">.id</span> <span class="kw">=</span> <span class="st">"tablename"</span>
) <span class="kw">%&gt;%</span>
  <span class="kw pkg">tibble</span><span class="kw ns">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span>()

<span class="no">df_metadata</span>
<span class="co">#&gt; # A tibble: 154 x 4</span>
<span class="co">#&gt;    tablename   name   description                  unit    </span>
<span class="co">#&gt;    &lt;chr&gt;       &lt;chr&gt;  &lt;chr&gt;                        &lt;chr&gt;   </span>
<span class="co">#&gt;  1 21311LS001A BIL002 Studierende / Studenten      "Anzahl"</span>
<span class="co">#&gt;  2 21311LS001A DLAND  Land                         ""      </span>
<span class="co">#&gt;  3 21311LS001A BILHS1 Hochschulen                  ""      </span>
<span class="co">#&gt;  4 21311LS001A BILSF1 Studienfach                  ""      </span>
<span class="co">#&gt;  5 21311LS001A BILFS1 Fachsemester                 ""      </span>
<span class="co">#&gt;  6 21311LS001A BILAP1 Angestrebte Abschlussprüfung ""      </span>
<span class="co">#&gt;  7 21311LS001A SEMEST Semester                     ""      </span>
<span class="co">#&gt;  8 21311LS002A BIL002 Studierende / Studenten      "Anzahl"</span>
<span class="co">#&gt;  9 21311LS002A DLAND  Land                         ""      </span>
<span class="co">#&gt; 10 21311LS002A BILHS1 Hochschulen                  ""      </span>
<span class="co">#&gt; # ... with 144 more rows</span>

<span class="co"># Create character vector of all unique variable names in all tables</span>
<span class="no">variables_unique</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(
  <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(
    <span class="no">df_metadata</span><span class="kw">[[</span><span class="st">"name"</span>]]
    )
  )

<span class="no">variables_unique</span>
<span class="co">#&gt;  [1] "BIL002" "DLAND"  "BILHS1" "BILSF1" "BILFS1" "BILAP1" "SEMEST" "BILSH1"</span>
<span class="co">#&gt;  [9] "GES"    "BILHN1" "NAT"    "BIL016"</span></pre></body></html></div>
<p>We now have a vector of 30 unique variables that are used in the table series “213”. The data tables use value keys and not the actual value labels (e.g. the variable “SX-A01” has the two value keys “SX-OPSCHUL1” and “SX-OPSCHUL2” with the labels “Öffentlich” (<em>Public</em>) and “Privat” (<em>private</em>) stored in separate key tables). We use a combination of <code><a href="https://purrr.tidyverse.org/reference/map.html">purrr::map</a></code> and <code><a href="https://rdrr.io/pkg/wiesbaden/man/retrieve_valuelabel.html">wiesbaden::retrieve_valuelabel</a></code> to retrieve all value labels for our data tables in a list.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="co"># Retrieve value labels with wiesbaden::retrieve_valuelabel</span>
<span class="no">list_value_labels</span> <span class="kw">&lt;-</span> <span class="kw pkg">purrr</span><span class="kw ns">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(
  <span class="no">variables_unique</span>,
  <span class="kw pkg">wiesbaden</span><span class="kw ns">::</span><span class="no"><a href="https://rdrr.io/pkg/wiesbaden/man/retrieve_valuelabel.html">retrieve_valuelabel</a></span>,
  <span class="kw">genesis</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">db</span> <span class="kw">=</span> <span class="st">"nrw"</span>)
  )

<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">list_value_labels</span>)
<span class="co">#&gt; List of 12</span>
<span class="co">#&gt;  $ : chr "No results found."</span>
<span class="co">#&gt;  $ :'data.frame':    1 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ DLAND      : chr "05"</span>
<span class="co">#&gt;   ..$ description: chr "Nordrhein-Westfalen"</span>
<span class="co">#&gt;  $ :'data.frame':    170 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ BILHS1     : chr [1:170] "HS0034" "HS0040" "HS0070" "HS0080" ...</span>
<span class="co">#&gt;   ..$ description: chr [1:170] "Hochschule Macromedia München in Köln (Priv. FH)" "Fachhochschule der Diakonie, Bielefeld-Bethel" "U-GH Duisburg" "U Duisburg-Essen" ...</span>
<span class="co">#&gt;  $ :'data.frame':    289 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ BILSF1     : chr [1:289] "SF001" "SF002" "SF003" "SF004" ...</span>
<span class="co">#&gt;   ..$ description: chr [1:289] "Ägyptologie" "Afrikanistik" "Agrarwissenschaft/Landwirtschaft" "Interdisz.Studien (Schwerpkt.Sprach-u.Kulturwiss.)" ...</span>
<span class="co">#&gt;  $ :'data.frame':    20 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ BILFS1     : chr [1:20] "FACHS01" "FACHS02" "FACHS03" "FACHS04" ...</span>
<span class="co">#&gt;   ..$ description: chr [1:20] "1. Fachsemester" "2. Fachsemester" "3. Fachsemester" "4. Fachsemester" ...</span>
<span class="co">#&gt;  $ :'data.frame':    99 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ BILAP1     : chr [1:99] "AP01" "AP02" "AP03" "AP04" ...</span>
<span class="co">#&gt;   ..$ description: chr [1:99] "Mehr-Fächer-Bachelor mit Lehramtsoption" "Magister" "Lizentiat" "Kirchliche Prüfung" ...</span>
<span class="co">#&gt;  $ : chr "No results found."</span>
<span class="co">#&gt;  $ :'data.frame':    20 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ BILSH1     : chr [1:20] "HOCHS01" "HOCHS02" "HOCHS03" "HOCHS04" ...</span>
<span class="co">#&gt;   ..$ description: chr [1:20] "1. Hochschulsemester" "2. Hochschulsemester" "3. Hochschulsemester" "4. Hochschulsemester" ...</span>
<span class="co">#&gt;  $ :'data.frame':    2 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ GES        : chr [1:2] "GESM" "GESW"</span>
<span class="co">#&gt;   ..$ description: chr [1:2] "männlich" "weiblich"</span>
<span class="co">#&gt;  $ :'data.frame':    2 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ BILHN1     : chr [1:2] "BILHN01" "BILHN02"</span>
<span class="co">#&gt;   ..$ description: chr [1:2] "Haupthörer" "Nebenhörer"</span>
<span class="co">#&gt;  $ :'data.frame':    2 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ NAT        : chr [1:2] "NATA" "NATD"</span>
<span class="co">#&gt;   ..$ description: chr [1:2] "Ausländer" "Deutsche"</span>
<span class="co">#&gt;  $ : chr "No results found."</span></pre></body></html></div>
<p>Unlike the downloaded data and metadata, which we have put into one data frame each, the value labels are put into a list of data frames. To retrieve a single element from that list, i.e. a single data frame of value labels, use double square brackets like this <code>list_value_labels_filtered[[1]]</code>.</p>
</div>
<div id="data-wrangling" class="section level1">
<h1 class="hasAnchor">
<a href="#data-wrangling" class="anchor"></a>Data Wrangling</h1>
<p>We now have all the data required and have done some minimal data cleaning and filtering. In this section, we clean the data some more and bring it all together in one data frame.</p>
<p>The Destatis data uses capitalized column names and column names containing hyphens. We automatically change this to snake case and replace special characters for all column names using <code><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">janitor::clean_names</a></code>. The data also includes three types of columns that do not seem to be documented and which serve no apparent purpose. Specifically, the undocumented columns ending in “qual” (the only value being “e”), “err” (always 0) and “lock” (always NA) are of no value to us, so we discard them from the data frame.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="co"># Clean all column names (e.g. replacing hyphens with underscores) and make them</span>
<span class="co"># use snake case.</span>
<span class="co"># Discard columns ending in "qual", "err", or "lock".</span>
<span class="no">df_cleaned</span> <span class="kw">&lt;-</span> <span class="no">df</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">janitor</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">clean_names</a></span>(
    <span class="kw">case</span> <span class="kw">=</span> <span class="st">"snake"</span>
  ) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(
    -<span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">ends_with</a></span>(
      <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(
        <span class="st">"qual"</span>,
        <span class="st">"err"</span>,
        <span class="st">"lock"</span>
        )
      )
    )

<span class="no">df_cleaned</span>
<span class="co">#&gt; # A tibble: 3,632,429 x 14</span>
<span class="co">#&gt;    tablename id21311 dland bilhs1 bilsf1 bilfs1 bilap1 semest bil002_val bilsh1</span>
<span class="co">#&gt;    &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt; </span>
<span class="co">#&gt;  1 21311LS0~ D       05    HS0034 SF054  FACHS~ AP84   WS 20~         40 &lt;NA&gt;  </span>
<span class="co">#&gt;  2 21311LS0~ D       05    HS0034 SF054  FACHS~ AP84   WS 20~         36 &lt;NA&gt;  </span>
<span class="co">#&gt;  3 21311LS0~ D       05    HS0034 SF054  FACHS~ AP84   WS 20~         35 &lt;NA&gt;  </span>
<span class="co">#&gt;  4 21311LS0~ D       05    HS0034 SF054  FACHS~ AP84   WS 20~         24 &lt;NA&gt;  </span>
<span class="co">#&gt;  5 21311LS0~ D       05    HS0034 SF054  FACHS~ AP84   WS 20~          2 &lt;NA&gt;  </span>
<span class="co">#&gt;  6 21311LS0~ D       05    HS0034 SF069  FACHS~ AP84   WS 20~         18 &lt;NA&gt;  </span>
<span class="co">#&gt;  7 21311LS0~ D       05    HS0034 SF069  FACHS~ AP84   WS 20~         14 &lt;NA&gt;  </span>
<span class="co">#&gt;  8 21311LS0~ D       05    HS0034 SF069  FACHS~ AP84   WS 20~         13 &lt;NA&gt;  </span>
<span class="co">#&gt;  9 21311LS0~ D       05    HS0034 SF069  FACHS~ AP84   WS 20~          7 &lt;NA&gt;  </span>
<span class="co">#&gt; 10 21311LS0~ D       05    HS0034 SF182  FACHS~ AP84   WS 20~         15 &lt;NA&gt;  </span>
<span class="co">#&gt; # ... with 3,632,419 more rows, and 4 more variables: ges &lt;chr&gt;, bilhn1 &lt;chr&gt;,</span>
<span class="co">#&gt; #   nat &lt;chr&gt;, bil016_val &lt;dbl&gt;</span></pre></body></html></div>
<p>In our list of value labels, some elements contain the string “No results found”. We drop these empty elements using <code><a href="https://purrr.tidyverse.org/reference/keep.html">purrr::discard</a></code>. We then apply <code><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">janitor::clean_names</a></code> to the list of data frames containing value labels. As we have also applied this function to the data frame with the actual data, this makes the column names between the different tables consistent.</p>
<p>Next, we want to combine all value labels with the data frame containing the actual data. Unfortunately, each data frame with value labels has a column “description”. We need to make this column unique across the list of data frames containing value labels, so that we know which value key the description applies to. First, we use <code><a href="https://purrr.tidyverse.org/reference/map.html">purrr::map_chr</a></code> to generate a character vector of the descriptions. This is then used as the input to another function, where we rename all the description columns to “description_” plus “key_id”.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="co"># Variables with no labels return a list with the character "No results found."</span>
<span class="co"># We use purrr::discard to drop all these empty list elements of type character.</span>
<span class="no">list_value_labels_filtered</span> <span class="kw">&lt;-</span> <span class="kw pkg">purrr</span><span class="kw ns">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/keep.html">discard</a></span>(
  <span class="no">list_value_labels</span>,
  ~ <span class="fu"><a href="https://rdrr.io/r/base/character.html">is.character</a></span>(<span class="no">.x</span>)
  )

<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">list_value_labels_filtered</span>)
<span class="co">#&gt; List of 9</span>
<span class="co">#&gt;  $ :'data.frame':    1 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ DLAND      : chr "05"</span>
<span class="co">#&gt;   ..$ description: chr "Nordrhein-Westfalen"</span>
<span class="co">#&gt;  $ :'data.frame':    170 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ BILHS1     : chr [1:170] "HS0034" "HS0040" "HS0070" "HS0080" ...</span>
<span class="co">#&gt;   ..$ description: chr [1:170] "Hochschule Macromedia München in Köln (Priv. FH)" "Fachhochschule der Diakonie, Bielefeld-Bethel" "U-GH Duisburg" "U Duisburg-Essen" ...</span>
<span class="co">#&gt;  $ :'data.frame':    289 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ BILSF1     : chr [1:289] "SF001" "SF002" "SF003" "SF004" ...</span>
<span class="co">#&gt;   ..$ description: chr [1:289] "Ägyptologie" "Afrikanistik" "Agrarwissenschaft/Landwirtschaft" "Interdisz.Studien (Schwerpkt.Sprach-u.Kulturwiss.)" ...</span>
<span class="co">#&gt;  $ :'data.frame':    20 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ BILFS1     : chr [1:20] "FACHS01" "FACHS02" "FACHS03" "FACHS04" ...</span>
<span class="co">#&gt;   ..$ description: chr [1:20] "1. Fachsemester" "2. Fachsemester" "3. Fachsemester" "4. Fachsemester" ...</span>
<span class="co">#&gt;  $ :'data.frame':    99 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ BILAP1     : chr [1:99] "AP01" "AP02" "AP03" "AP04" ...</span>
<span class="co">#&gt;   ..$ description: chr [1:99] "Mehr-Fächer-Bachelor mit Lehramtsoption" "Magister" "Lizentiat" "Kirchliche Prüfung" ...</span>
<span class="co">#&gt;  $ :'data.frame':    20 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ BILSH1     : chr [1:20] "HOCHS01" "HOCHS02" "HOCHS03" "HOCHS04" ...</span>
<span class="co">#&gt;   ..$ description: chr [1:20] "1. Hochschulsemester" "2. Hochschulsemester" "3. Hochschulsemester" "4. Hochschulsemester" ...</span>
<span class="co">#&gt;  $ :'data.frame':    2 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ GES        : chr [1:2] "GESM" "GESW"</span>
<span class="co">#&gt;   ..$ description: chr [1:2] "männlich" "weiblich"</span>
<span class="co">#&gt;  $ :'data.frame':    2 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ BILHN1     : chr [1:2] "BILHN01" "BILHN02"</span>
<span class="co">#&gt;   ..$ description: chr [1:2] "Haupthörer" "Nebenhörer"</span>
<span class="co">#&gt;  $ :'data.frame':    2 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ NAT        : chr [1:2] "NATA" "NATD"</span>
<span class="co">#&gt;   ..$ description: chr [1:2] "Ausländer" "Deutsche"</span>

<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">list_value_labels_filtered</span><span class="kw">[[</span><span class="fl">1</span>]]<span class="kw">[[</span><span class="st">"description"</span>]])
<span class="co">#&gt;  chr "Nordrhein-Westfalen"</span>

<span class="co"># Clean all column names with janitor</span>
<span class="no">list_value_labels_wrangled</span> <span class="kw">&lt;-</span> <span class="no">list_value_labels_filtered</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">purrr</span><span class="kw ns">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(
    <span class="kw pkg">janitor</span><span class="kw ns">::</span><span class="no"><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">clean_names</a></span>,
    <span class="kw">case</span> <span class="kw">=</span> <span class="st">"snake"</span>
  )

<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">list_value_labels_wrangled</span>)
<span class="co">#&gt; List of 9</span>
<span class="co">#&gt;  $ :'data.frame':    1 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ dland      : chr "05"</span>
<span class="co">#&gt;   ..$ description: chr "Nordrhein-Westfalen"</span>
<span class="co">#&gt;  $ :'data.frame':    170 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ bilhs1     : chr [1:170] "HS0034" "HS0040" "HS0070" "HS0080" ...</span>
<span class="co">#&gt;   ..$ description: chr [1:170] "Hochschule Macromedia München in Köln (Priv. FH)" "Fachhochschule der Diakonie, Bielefeld-Bethel" "U-GH Duisburg" "U Duisburg-Essen" ...</span>
<span class="co">#&gt;  $ :'data.frame':    289 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ bilsf1     : chr [1:289] "SF001" "SF002" "SF003" "SF004" ...</span>
<span class="co">#&gt;   ..$ description: chr [1:289] "Ägyptologie" "Afrikanistik" "Agrarwissenschaft/Landwirtschaft" "Interdisz.Studien (Schwerpkt.Sprach-u.Kulturwiss.)" ...</span>
<span class="co">#&gt;  $ :'data.frame':    20 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ bilfs1     : chr [1:20] "FACHS01" "FACHS02" "FACHS03" "FACHS04" ...</span>
<span class="co">#&gt;   ..$ description: chr [1:20] "1. Fachsemester" "2. Fachsemester" "3. Fachsemester" "4. Fachsemester" ...</span>
<span class="co">#&gt;  $ :'data.frame':    99 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ bilap1     : chr [1:99] "AP01" "AP02" "AP03" "AP04" ...</span>
<span class="co">#&gt;   ..$ description: chr [1:99] "Mehr-Fächer-Bachelor mit Lehramtsoption" "Magister" "Lizentiat" "Kirchliche Prüfung" ...</span>
<span class="co">#&gt;  $ :'data.frame':    20 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ bilsh1     : chr [1:20] "HOCHS01" "HOCHS02" "HOCHS03" "HOCHS04" ...</span>
<span class="co">#&gt;   ..$ description: chr [1:20] "1. Hochschulsemester" "2. Hochschulsemester" "3. Hochschulsemester" "4. Hochschulsemester" ...</span>
<span class="co">#&gt;  $ :'data.frame':    2 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ ges        : chr [1:2] "GESM" "GESW"</span>
<span class="co">#&gt;   ..$ description: chr [1:2] "männlich" "weiblich"</span>
<span class="co">#&gt;  $ :'data.frame':    2 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ bilhn1     : chr [1:2] "BILHN01" "BILHN02"</span>
<span class="co">#&gt;   ..$ description: chr [1:2] "Haupthörer" "Nebenhörer"</span>
<span class="co">#&gt;  $ :'data.frame':    2 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ nat        : chr [1:2] "NATA" "NATD"</span>
<span class="co">#&gt;   ..$ description: chr [1:2] "Ausländer" "Deutsche"</span>

<span class="co"># Generate a character vector of unique description column names</span>
<span class="no">description_names</span> <span class="kw">&lt;-</span> <span class="kw pkg">purrr</span><span class="kw ns">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span>(
  <span class="kw pkg">purrr</span><span class="kw ns">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(
    <span class="no">list_value_labels_wrangled</span>,
    ~ <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">.x</span>), <span class="st">"_description"</span>)
  ),
  <span class="fl">1</span>
)

<span class="no">description_names</span>
<span class="co">#&gt; [1] "dland_description"  "bilhs1_description" "bilsf1_description"</span>
<span class="co">#&gt; [4] "bilfs1_description" "bilap1_description" "bilsh1_description"</span>
<span class="co">#&gt; [7] "ges_description"    "bilhn1_description" "nat_description"</span>

<span class="co"># Rename the existing description column names to make them unique</span>
<span class="no">list_value_labels_unique</span> <span class="kw">&lt;-</span> <span class="kw pkg">purrr</span><span class="kw ns">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">map2</a></span>(
  <span class="no">list_value_labels_wrangled</span>,
  <span class="no">description_names</span>,
  ~<span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span>(
    <span class="no">.x</span>,
    !!<span class="no">.y</span> <span class="kw">:=</span> <span class="no">description</span>
    )
)

<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">list_value_labels_unique</span>)
<span class="co">#&gt; List of 9</span>
<span class="co">#&gt;  $ :'data.frame':    1 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ dland            : chr "05"</span>
<span class="co">#&gt;   ..$ dland_description: chr "Nordrhein-Westfalen"</span>
<span class="co">#&gt;  $ :'data.frame':    170 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ bilhs1            : chr [1:170] "HS0034" "HS0040" "HS0070" "HS0080" ...</span>
<span class="co">#&gt;   ..$ bilhs1_description: chr [1:170] "Hochschule Macromedia München in Köln (Priv. FH)" "Fachhochschule der Diakonie, Bielefeld-Bethel" "U-GH Duisburg" "U Duisburg-Essen" ...</span>
<span class="co">#&gt;  $ :'data.frame':    289 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ bilsf1            : chr [1:289] "SF001" "SF002" "SF003" "SF004" ...</span>
<span class="co">#&gt;   ..$ bilsf1_description: chr [1:289] "Ägyptologie" "Afrikanistik" "Agrarwissenschaft/Landwirtschaft" "Interdisz.Studien (Schwerpkt.Sprach-u.Kulturwiss.)" ...</span>
<span class="co">#&gt;  $ :'data.frame':    20 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ bilfs1            : chr [1:20] "FACHS01" "FACHS02" "FACHS03" "FACHS04" ...</span>
<span class="co">#&gt;   ..$ bilfs1_description: chr [1:20] "1. Fachsemester" "2. Fachsemester" "3. Fachsemester" "4. Fachsemester" ...</span>
<span class="co">#&gt;  $ :'data.frame':    99 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ bilap1            : chr [1:99] "AP01" "AP02" "AP03" "AP04" ...</span>
<span class="co">#&gt;   ..$ bilap1_description: chr [1:99] "Mehr-Fächer-Bachelor mit Lehramtsoption" "Magister" "Lizentiat" "Kirchliche Prüfung" ...</span>
<span class="co">#&gt;  $ :'data.frame':    20 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ bilsh1            : chr [1:20] "HOCHS01" "HOCHS02" "HOCHS03" "HOCHS04" ...</span>
<span class="co">#&gt;   ..$ bilsh1_description: chr [1:20] "1. Hochschulsemester" "2. Hochschulsemester" "3. Hochschulsemester" "4. Hochschulsemester" ...</span>
<span class="co">#&gt;  $ :'data.frame':    2 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ ges            : chr [1:2] "GESM" "GESW"</span>
<span class="co">#&gt;   ..$ ges_description: chr [1:2] "männlich" "weiblich"</span>
<span class="co">#&gt;  $ :'data.frame':    2 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ bilhn1            : chr [1:2] "BILHN01" "BILHN02"</span>
<span class="co">#&gt;   ..$ bilhn1_description: chr [1:2] "Haupthörer" "Nebenhörer"</span>
<span class="co">#&gt;  $ :'data.frame':    2 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ nat            : chr [1:2] "NATA" "NATD"</span>
<span class="co">#&gt;   ..$ nat_description: chr [1:2] "Ausländer" "Deutsche"</span></pre></body></html></div>
<p>We are now ready to combine the data with the corresponding labels. Before, though, we will retrieve another set of labels, describing the contents of each table. As with the value labels, we rename the generic “description” column to “tablename_description” to make it unique.</p>
<p>For combining tables that share a mutual key or mutal set of keys, we use <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">dplyr::left_join</a></code>. Because we have so many individual tables and keys, doing this manually would be tedious. To avoid this manual process, we use <code><a href="https://purrr.tidyverse.org/reference/reduce.html">purrr::reduce</a></code> on a list of all data frames we want to join. So before applying <code><a href="https://purrr.tidyverse.org/reference/reduce.html">purrr::reduce</a></code>, we put the data frame with the actual data, the data frame with the table descriptions, and the list of data frames containing value labels into one big list.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="co"># Create data frame with table name and table description</span>
<span class="no">df_table_descriptions</span> <span class="kw">&lt;-</span> <span class="no">df_table</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span>(
   <span class="kw">tablename_description</span> <span class="kw">=</span> <span class="no">description</span>
  )

<span class="no">df_table_descriptions</span>
<span class="co">#&gt; # A tibble: 25 x 2</span>
<span class="co">#&gt;    tablename   tablename_description                                            </span>
<span class="co">#&gt;    &lt;chr&gt;       &lt;chr&gt;                                                            </span>
<span class="co">#&gt;  1 21311LS001A Studierende / Studenten, Land, Hochschulen, Studienfach, Fachsem~</span>
<span class="co">#&gt;  2 21311LS002A Studierende / Studenten, Land, Hochschulen, Studienfach, Hochsch~</span>
<span class="co">#&gt;  3 21311NW001A Studierende / Studenten, Land, Hochschulen, Fachsemester, Geschl~</span>
<span class="co">#&gt;  4 21311NW001B Studierende / Studenten, Land, Hochschulen, Fachsemester, Nation~</span>
<span class="co">#&gt;  5 21311NW002A Studierende / Studenten, Land, Hochschulen, Fachsemester, Geschl~</span>
<span class="co">#&gt;  6 21311NW002B Studierende / Studenten, Land, Hochschulen, Fachsemester, Nation~</span>
<span class="co">#&gt;  7 21311NW002C Studierende / Studenten, Land, Fachsemester, Nationalität, Gesch~</span>
<span class="co">#&gt;  8 21311NW003A Studierende / Studenten, Land, Hochschulen, Geschlecht, Hörersta~</span>
<span class="co">#&gt;  9 21311NW003B Studierende / Studenten, Land, Hochschulen, Nationalität, Hörers~</span>
<span class="co">#&gt; 10 21311NW004A Studierende / Studenten, Land, Studienfach, Geschlecht, Hörersta~</span>
<span class="co">#&gt; # ... with 15 more rows</span>

<span class="co"># Combine actual data with the data frame of table names and the list of data </span>
<span class="co"># frames containing value labels into one list.</span>
<span class="no">df_list_tmp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/append.html">append</a></span>(
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">df_cleaned</span>),
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">df_table_descriptions</span>)
)

<span class="no">df_list</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/append.html">append</a></span>(
  <span class="no">df_list_tmp</span>,
  <span class="no">list_value_labels_unique</span>
)

<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">df_list</span>)
<span class="co">#&gt; List of 11</span>
<span class="co">#&gt;  $ : tibble [3,632,429 x 14] (S3: tbl_df/tbl/data.frame)</span>
<span class="co">#&gt;   ..$ tablename : chr [1:3632429] "21311LS001A" "21311LS001A" "21311LS001A" "21311LS001A" ...</span>
<span class="co">#&gt;   ..$ id21311   : chr [1:3632429] "D" "D" "D" "D" ...</span>
<span class="co">#&gt;   ..$ dland     : chr [1:3632429] "05" "05" "05" "05" ...</span>
<span class="co">#&gt;   ..$ bilhs1    : chr [1:3632429] "HS0034" "HS0034" "HS0034" "HS0034" ...</span>
<span class="co">#&gt;   ..$ bilsf1    : chr [1:3632429] "SF054" "SF054" "SF054" "SF054" ...</span>
<span class="co">#&gt;   ..$ bilfs1    : chr [1:3632429] "FACHS01" "FACHS03" "FACHS05" "FACHS07" ...</span>
<span class="co">#&gt;   ..$ bilap1    : chr [1:3632429] "AP84" "AP84" "AP84" "AP84" ...</span>
<span class="co">#&gt;   ..$ semest    : chr [1:3632429] "WS 2017/18" "WS 2017/18" "WS 2017/18" "WS 2017/18" ...</span>
<span class="co">#&gt;   ..$ bil002_val: num [1:3632429] 40 36 35 24 2 18 14 13 7 15 ...</span>
<span class="co">#&gt;   ..$ bilsh1    : chr [1:3632429] NA NA NA NA ...</span>
<span class="co">#&gt;   ..$ ges       : chr [1:3632429] NA NA NA NA ...</span>
<span class="co">#&gt;   ..$ bilhn1    : chr [1:3632429] NA NA NA NA ...</span>
<span class="co">#&gt;   ..$ nat       : chr [1:3632429] NA NA NA NA ...</span>
<span class="co">#&gt;   ..$ bil016_val: num [1:3632429] NA NA NA NA NA NA NA NA NA NA ...</span>
<span class="co">#&gt;   ..- attr(*, "spec")=</span>
<span class="co">#&gt;   .. .. cols(</span>
<span class="co">#&gt;   .. ..   id21311 = col_character(),</span>
<span class="co">#&gt;   .. ..   DLAND = col_character(),</span>
<span class="co">#&gt;   .. ..   BILHS1 = col_character(),</span>
<span class="co">#&gt;   .. ..   BILSF1 = col_character(),</span>
<span class="co">#&gt;   .. ..   BILFS1 = col_character(),</span>
<span class="co">#&gt;   .. ..   BILAP1 = col_character(),</span>
<span class="co">#&gt;   .. ..   SEMEST = col_character(),</span>
<span class="co">#&gt;   .. ..   BIL002_val = col_double(),</span>
<span class="co">#&gt;   .. ..   BIL002_qual = col_character(),</span>
<span class="co">#&gt;   .. ..   BIL002_lock = col_logical(),</span>
<span class="co">#&gt;   .. ..   BIL002_err = col_double()</span>
<span class="co">#&gt;   .. .. )</span>
<span class="co">#&gt;  $ : tibble [25 x 2] (S3: tbl_df/tbl/data.frame)</span>
<span class="co">#&gt;   ..$ tablename            : chr [1:25] "21311LS001A" "21311LS002A" "21311NW001A" "21311NW001B" ...</span>
<span class="co">#&gt;   ..$ tablename_description: chr [1:25] "Studierende / Studenten, Land, Hochschulen, Studienfach, Fachsemester, Angestrebte Abschlussprüfung, Semester" "Studierende / Studenten, Land, Hochschulen, Studienfach, Hochschulsemester, Angestrebte Abschlussprüfung, Semester" "Studierende / Studenten, Land, Hochschulen, Fachsemester, Geschlecht, Hörerstatus, Angestrebte Abschlussprüfung, Semester" "Studierende / Studenten, Land, Hochschulen, Fachsemester, Nationalität, Hörerstatus, Angestrebte Abschlussprüfung, Semester" ...</span>
<span class="co">#&gt;  $ :'data.frame':    1 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ dland            : chr "05"</span>
<span class="co">#&gt;   ..$ dland_description: chr "Nordrhein-Westfalen"</span>
<span class="co">#&gt;  $ :'data.frame':    170 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ bilhs1            : chr [1:170] "HS0034" "HS0040" "HS0070" "HS0080" ...</span>
<span class="co">#&gt;   ..$ bilhs1_description: chr [1:170] "Hochschule Macromedia München in Köln (Priv. FH)" "Fachhochschule der Diakonie, Bielefeld-Bethel" "U-GH Duisburg" "U Duisburg-Essen" ...</span>
<span class="co">#&gt;  $ :'data.frame':    289 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ bilsf1            : chr [1:289] "SF001" "SF002" "SF003" "SF004" ...</span>
<span class="co">#&gt;   ..$ bilsf1_description: chr [1:289] "Ägyptologie" "Afrikanistik" "Agrarwissenschaft/Landwirtschaft" "Interdisz.Studien (Schwerpkt.Sprach-u.Kulturwiss.)" ...</span>
<span class="co">#&gt;  $ :'data.frame':    20 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ bilfs1            : chr [1:20] "FACHS01" "FACHS02" "FACHS03" "FACHS04" ...</span>
<span class="co">#&gt;   ..$ bilfs1_description: chr [1:20] "1. Fachsemester" "2. Fachsemester" "3. Fachsemester" "4. Fachsemester" ...</span>
<span class="co">#&gt;  $ :'data.frame':    99 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ bilap1            : chr [1:99] "AP01" "AP02" "AP03" "AP04" ...</span>
<span class="co">#&gt;   ..$ bilap1_description: chr [1:99] "Mehr-Fächer-Bachelor mit Lehramtsoption" "Magister" "Lizentiat" "Kirchliche Prüfung" ...</span>
<span class="co">#&gt;  $ :'data.frame':    20 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ bilsh1            : chr [1:20] "HOCHS01" "HOCHS02" "HOCHS03" "HOCHS04" ...</span>
<span class="co">#&gt;   ..$ bilsh1_description: chr [1:20] "1. Hochschulsemester" "2. Hochschulsemester" "3. Hochschulsemester" "4. Hochschulsemester" ...</span>
<span class="co">#&gt;  $ :'data.frame':    2 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ ges            : chr [1:2] "GESM" "GESW"</span>
<span class="co">#&gt;   ..$ ges_description: chr [1:2] "männlich" "weiblich"</span>
<span class="co">#&gt;  $ :'data.frame':    2 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ bilhn1            : chr [1:2] "BILHN01" "BILHN02"</span>
<span class="co">#&gt;   ..$ bilhn1_description: chr [1:2] "Haupthörer" "Nebenhörer"</span>
<span class="co">#&gt;  $ :'data.frame':    2 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ nat            : chr [1:2] "NATA" "NATD"</span>
<span class="co">#&gt;   ..$ nat_description: chr [1:2] "Ausländer" "Deutsche"</span>

<span class="co"># Join data with all the value label data frames to create one big data frame</span>
<span class="no">df_joined</span> <span class="kw">&lt;-</span> <span class="kw pkg">purrr</span><span class="kw ns">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/reduce.html">reduce</a></span>(
  <span class="no">df_list</span>,
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="no"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span>
) <span class="kw">%&gt;%</span>
  <span class="kw pkg">tibble</span><span class="kw ns">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span>()

<span class="no">df_joined</span>
<span class="co">#&gt; # A tibble: 3,632,429 x 24</span>
<span class="co">#&gt;    tablename id21311 dland bilhs1 bilsf1 bilfs1 bilap1 semest bil002_val bilsh1</span>
<span class="co">#&gt;    &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt; </span>
<span class="co">#&gt;  1 21311LS0~ D       05    HS0034 SF054  FACHS~ AP84   WS 20~         40 &lt;NA&gt;  </span>
<span class="co">#&gt;  2 21311LS0~ D       05    HS0034 SF054  FACHS~ AP84   WS 20~         36 &lt;NA&gt;  </span>
<span class="co">#&gt;  3 21311LS0~ D       05    HS0034 SF054  FACHS~ AP84   WS 20~         35 &lt;NA&gt;  </span>
<span class="co">#&gt;  4 21311LS0~ D       05    HS0034 SF054  FACHS~ AP84   WS 20~         24 &lt;NA&gt;  </span>
<span class="co">#&gt;  5 21311LS0~ D       05    HS0034 SF054  FACHS~ AP84   WS 20~          2 &lt;NA&gt;  </span>
<span class="co">#&gt;  6 21311LS0~ D       05    HS0034 SF069  FACHS~ AP84   WS 20~         18 &lt;NA&gt;  </span>
<span class="co">#&gt;  7 21311LS0~ D       05    HS0034 SF069  FACHS~ AP84   WS 20~         14 &lt;NA&gt;  </span>
<span class="co">#&gt;  8 21311LS0~ D       05    HS0034 SF069  FACHS~ AP84   WS 20~         13 &lt;NA&gt;  </span>
<span class="co">#&gt;  9 21311LS0~ D       05    HS0034 SF069  FACHS~ AP84   WS 20~          7 &lt;NA&gt;  </span>
<span class="co">#&gt; 10 21311LS0~ D       05    HS0034 SF182  FACHS~ AP84   WS 20~         15 &lt;NA&gt;  </span>
<span class="co">#&gt; # ... with 3,632,419 more rows, and 14 more variables: ges &lt;chr&gt;, bilhn1 &lt;chr&gt;,</span>
<span class="co">#&gt; #   nat &lt;chr&gt;, bil016_val &lt;dbl&gt;, tablename_description &lt;chr&gt;,</span>
<span class="co">#&gt; #   dland_description &lt;chr&gt;, bilhs1_description &lt;chr&gt;,</span>
<span class="co">#&gt; #   bilsf1_description &lt;chr&gt;, bilfs1_description &lt;chr&gt;,</span>
<span class="co">#&gt; #   bilap1_description &lt;chr&gt;, bilsh1_description &lt;chr&gt;, ges_description &lt;chr&gt;,</span>
<span class="co">#&gt; #   bilhn1_description &lt;chr&gt;, nat_description &lt;chr&gt;</span></pre></body></html></div>
<p>We also sort the columns (not the rows!) alphabetically, so that the descriptions come immediately after the respective key column. The first two columns are always the table code and the table description.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="co"># Order columns alphabetically, put columns tablename and tablename_description </span>
<span class="co"># first, put value columns last.</span>
<span class="no">db_nrw_213</span> <span class="kw">&lt;-</span> <span class="no">df_joined</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(
    <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span>(
      <span class="kw pkg">tidyselect</span><span class="kw ns">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/peek_vars.html">peek_vars</a></span>()
      )
  ) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span>(
    <span class="no">tablename</span>,
    <span class="no">tablename_description</span>,
    !(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">ends_with</a></span>(<span class="st">"_val"</span>)),
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">ends_with</a></span>(<span class="st">"val"</span>)
    )

<span class="no">db_nrw_213</span>
<span class="co">#&gt; # A tibble: 3,632,429 x 24</span>
<span class="co">#&gt;    tablename tablename_descr~ bilap1 bilap1_descript~ bilfs1 bilfs1_descript~</span>
<span class="co">#&gt;    &lt;chr&gt;     &lt;chr&gt;            &lt;chr&gt;  &lt;chr&gt;            &lt;chr&gt;  &lt;chr&gt;           </span>
<span class="co">#&gt;  1 21311LS0~ Studierende / S~ AP84   Bachelor (FH)    FACHS~ 1. Fachsemester </span>
<span class="co">#&gt;  2 21311LS0~ Studierende / S~ AP84   Bachelor (FH)    FACHS~ 3. Fachsemester </span>
<span class="co">#&gt;  3 21311LS0~ Studierende / S~ AP84   Bachelor (FH)    FACHS~ 5. Fachsemester </span>
<span class="co">#&gt;  4 21311LS0~ Studierende / S~ AP84   Bachelor (FH)    FACHS~ 7. Fachsemester </span>
<span class="co">#&gt;  5 21311LS0~ Studierende / S~ AP84   Bachelor (FH)    FACHS~ 9. Fachsemester </span>
<span class="co">#&gt;  6 21311LS0~ Studierende / S~ AP84   Bachelor (FH)    FACHS~ 1. Fachsemester </span>
<span class="co">#&gt;  7 21311LS0~ Studierende / S~ AP84   Bachelor (FH)    FACHS~ 3. Fachsemester </span>
<span class="co">#&gt;  8 21311LS0~ Studierende / S~ AP84   Bachelor (FH)    FACHS~ 5. Fachsemester </span>
<span class="co">#&gt;  9 21311LS0~ Studierende / S~ AP84   Bachelor (FH)    FACHS~ 7. Fachsemester </span>
<span class="co">#&gt; 10 21311LS0~ Studierende / S~ AP84   Bachelor (FH)    FACHS~ 1. Fachsemester </span>
<span class="co">#&gt; # ... with 3,632,419 more rows, and 18 more variables: bilhn1 &lt;chr&gt;,</span>
<span class="co">#&gt; #   bilhn1_description &lt;chr&gt;, bilhs1 &lt;chr&gt;, bilhs1_description &lt;chr&gt;,</span>
<span class="co">#&gt; #   bilsf1 &lt;chr&gt;, bilsf1_description &lt;chr&gt;, bilsh1 &lt;chr&gt;,</span>
<span class="co">#&gt; #   bilsh1_description &lt;chr&gt;, dland &lt;chr&gt;, dland_description &lt;chr&gt;, ges &lt;chr&gt;,</span>
<span class="co">#&gt; #   ges_description &lt;chr&gt;, id21311 &lt;chr&gt;, nat &lt;chr&gt;, nat_description &lt;chr&gt;,</span>
<span class="co">#&gt; #   semest &lt;chr&gt;, bil002_val &lt;dbl&gt;, bil016_val &lt;dbl&gt;</span></pre></body></html></div>
</div>
<div id="working-with-the-destatis-data" class="section level1">
<h1 class="hasAnchor">
<a href="#working-with-the-destatis-data" class="anchor"></a>Working with the Destatis data</h1>
<p>We usually do not want to work with the entire data frame at once. The RUBer package provides the function <code>filter_destatis_code</code>, which allows you to filter the data based on a table code. It also discards all columns that only consist of NA after filtering. As an example, let us create a data frame consisting of all data for table code “21311LS001A”.</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="co"># Get all rows and columns for table code 21311LS001A</span>
<span class="no">df_21311LS001A</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/filter_destatis_code.html">filter_destatis_code</a></span>(
  <span class="kw">df</span> <span class="kw">=</span> <span class="no">db_nrw_213</span>,
  <span class="kw">tablename</span> <span class="kw">=</span> <span class="st">"21311LS001A"</span>
  )</pre></body></html></div>
<p>The table description says that this table contains “Studierende / Studenten, Land, Hochschulen, Studienfach, Fachsemester, Angestrebte Abschlussprüfung, Semester”. So essentially it is a table of students for each degree program, term, and university. We will do some basic analysis and plotting using this data.</p>
<p>First, let us find out which five universities had the highest overall number of students with the help of <code><a href="https://forcats.tidyverse.org/reference/fct_lump.html">forcats::fct_lump_n</a></code>.</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="co"># Create data frame with plotting data, filtering on the winter term 2017/18,</span>
<span class="co"># focusing on the top five universities in terms of student count and keeping</span>
<span class="co"># the top five degree types, in addition to a lumped category "other degrees".</span>
<span class="no">df_plot</span> <span class="kw">&lt;-</span> <span class="no">df_21311LS001A</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(
    <span class="no">semest</span> <span class="kw">==</span> <span class="st">"WS 2017/18"</span>
  ) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
    <span class="kw">bilhs1_description</span> <span class="kw">=</span> <span class="kw pkg">forcats</span><span class="kw ns">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_lump.html">fct_lump_n</a></span>(
      <span class="no">bilhs1_description</span>,
      <span class="kw">n</span> <span class="kw">=</span> <span class="fl">5</span>,
      <span class="kw">w</span> <span class="kw">=</span> <span class="no">bil002_val</span>,
      <span class="kw">other_level</span> <span class="kw">=</span> <span class="st">"Other NRW universities"</span>
      )
  ) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(
    <span class="no">bilhs1_description</span> <span class="kw">!=</span> <span class="st">"Other NRW universities"</span>
  ) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
    <span class="kw">bilap1</span> <span class="kw">=</span> <span class="kw pkg">forcats</span><span class="kw ns">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_lump.html">fct_lump_n</a></span>(
      <span class="no">bilap1</span>,
      <span class="kw">n</span> <span class="kw">=</span> <span class="fl">5</span>,
      <span class="kw">w</span> <span class="kw">=</span> <span class="no">bil002_val</span>,
      <span class="kw">other_level</span> <span class="kw">=</span> <span class="st">"Other degrees"</span>
      ),
    <span class="kw">bilap1_description</span> <span class="kw">=</span> <span class="kw pkg">forcats</span><span class="kw ns">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_lump.html">fct_lump_n</a></span>(
      <span class="no">bilap1_description</span>,
      <span class="kw">n</span> <span class="kw">=</span> <span class="fl">5</span>,
      <span class="kw">w</span> <span class="kw">=</span> <span class="no">bil002_val</span>,
      <span class="kw">other_level</span> <span class="kw">=</span> <span class="st">"Other degrees"</span>
      )
    )

<span class="fu"><a href="../reference/rub_plot_type_1.html">rub_plot_type_1</a></span>(
  <span class="kw">df</span> <span class="kw">=</span> <span class="no">df_plot</span>,
  <span class="kw">x_var</span> <span class="kw">=</span> <span class="no">bilhs1_description</span>,
  <span class="kw">y_var</span> <span class="kw">=</span> <span class="no">bil002_val</span>,
  <span class="kw">fill_var</span> <span class="kw">=</span> <span class="no">bilap1_description</span>,
  <span class="kw">y_axis_label</span> <span class="kw">=</span> <span class="st">"Students in winter term 2017/18"</span>,
  <span class="kw">caption</span> <span class="kw">=</span> <span class="st">"Landesdatenbank NRW, Table Code 21311LS001A (license dl-de/by-2-0)"</span>,
  <span class="kw">caption_prefix</span> <span class="kw">=</span> <span class="st">"Source:"</span>,
  <span class="kw">filter_cutoff</span> <span class="kw">=</span> <span class="fl">0.06</span>
<span class="co">#  ,fill_reverse = TRUE</span>
)</pre></body></html></div>
<div class="figure">
<img src="wiesbaden_files/figure-html/21311LS001A-plot1-1.png" alt="Students at the five biggest universities in NRW for the winter term 2017/18 for each degree (Vertical stacked bar chart)" width="700.0000032"><p class="caption">
Students at the five biggest universities in NRW for the winter term 2017/18 for each degree (Vertical stacked bar chart)
</p>
</div>
<p>The Fernuniversität Hagen, the TH Aachen, the University of Bochum, the University of Köln and the University of Münster had the highest student count in the winter term 2017/18. Maybe we are interested more specifically in the relative importance of each degree type at each university. We can use <code>rub_plot_type_2</code> for that:</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="fu"><a href="../reference/rub_plot_type_2.html">rub_plot_type_2</a></span>(
  <span class="kw">df</span> <span class="kw">=</span> <span class="no">df_plot</span>,
  <span class="kw">x_var</span> <span class="kw">=</span> <span class="no">bilhs1_description</span>,
  <span class="kw">y_var</span> <span class="kw">=</span> <span class="no">bil002_val</span>,
  <span class="kw">y_axis_label</span> <span class="kw">=</span> <span class="st">"Students in winter term 2017/18"</span>,
  <span class="kw">fill_var</span> <span class="kw">=</span> <span class="no">bilap1_description</span>,
  <span class="kw">caption</span> <span class="kw">=</span> <span class="st">"Landesdatenbank NRW, Table Code 21311LS001A (license dl-de/by-2-0)"</span>,
  <span class="kw">caption_prefix</span> <span class="kw">=</span> <span class="st">"Source:"</span>,
  <span class="kw">filter_cutoff</span> <span class="kw">=</span> <span class="fl">0.05</span>
<span class="co"># ,fill_reverse = TRUE</span>
<span class="co"># ,palette_reverse = TRUE</span>
)</pre></body></html></div>
<div class="figure">
<img src="wiesbaden_files/figure-html/21311LS001A-plot2-1.png" alt="Students at the five biggest universities in NRW for the winter term 2017/18 for each degree (Vertical stacked bar chart scaled to 100 percent)" width="700.0000032"><p class="caption">
Students at the five biggest universities in NRW for the winter term 2017/18 for each degree (Vertical stacked bar chart scaled to 100 percent)
</p>
</div>
<p>If we wanted to examine how the relative importance of each degree has developed over time, we could switch to <code>rub_plot_type_3</code> (a rotated version of type 2), use the term as y-variable and the university name as facet variable.</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="co"># Create data frame with plotting data, filtering on the winter terms 2013-2018,</span>
<span class="co"># focusing on the top five universities in terms of student count and keeping</span>
<span class="co"># the top five degree types, in addition to a lumped category "other degrees".</span>
<span class="no">df_plot_t3</span> <span class="kw">&lt;-</span> <span class="no">df_21311LS001A</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(
    <span class="no">semest</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(
      <span class="st">"WS 2017/18"</span>,
      <span class="st">"WS 2016/17"</span>,
      <span class="st">"WS 2015/16"</span>,
      <span class="st">"WS 2014/15"</span>,
      <span class="st">"WS 2013/14"</span>
      )
    ) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
    <span class="kw">bilhs1_description</span> <span class="kw">=</span> <span class="kw pkg">forcats</span><span class="kw ns">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_lump.html">fct_lump_n</a></span>(
      <span class="no">bilhs1_description</span>,
      <span class="kw">n</span> <span class="kw">=</span> <span class="fl">5</span>,
      <span class="kw">w</span> <span class="kw">=</span> <span class="no">bil002_val</span>,
      <span class="kw">other_level</span> <span class="kw">=</span> <span class="st">"Other NRW universities"</span>
      )
  ) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(
    <span class="no">bilhs1_description</span> <span class="kw">!=</span> <span class="st">"Other NRW universities"</span>
  ) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
    <span class="kw">bilap1</span> <span class="kw">=</span> <span class="kw pkg">forcats</span><span class="kw ns">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_lump.html">fct_lump_n</a></span>(
      <span class="no">bilap1</span>,
      <span class="kw">n</span> <span class="kw">=</span> <span class="fl">5</span>,
      <span class="kw">w</span> <span class="kw">=</span> <span class="no">bil002_val</span>,
      <span class="kw">other_level</span> <span class="kw">=</span> <span class="st">"Other degrees"</span>
      ),
    <span class="kw">bilap1_description</span> <span class="kw">=</span> <span class="kw pkg">forcats</span><span class="kw ns">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_lump.html">fct_lump_n</a></span>(
      <span class="no">bilap1_description</span>,
      <span class="kw">n</span> <span class="kw">=</span> <span class="fl">5</span>,
      <span class="kw">w</span> <span class="kw">=</span> <span class="no">bil002_val</span>,
      <span class="kw">other_level</span> <span class="kw">=</span> <span class="st">"Other degrees"</span>
      )
    )

<span class="fu"><a href="../reference/rub_plot_type_3.html">rub_plot_type_3</a></span>(
  <span class="kw">df</span> <span class="kw">=</span> <span class="no">df_plot_t3</span>,
  <span class="kw">x_var</span> <span class="kw">=</span> <span class="no">bil002_val</span>,
  <span class="kw">y_var</span> <span class="kw">=</span> <span class="no">semest</span>,
  <span class="kw">facet_var</span> <span class="kw">=</span> <span class="no">bilhs1_description</span>,
  <span class="kw">fill_var</span> <span class="kw">=</span> <span class="no">bilap1_description</span>,
  <span class="kw">caption</span> <span class="kw">=</span> <span class="st">"Landesdatenbank NRW, Table Code 21311LS001A (license dl-de/by-2-0)"</span>,
  <span class="kw">caption_prefix</span> <span class="kw">=</span> <span class="st">"Source:"</span>,
  <span class="kw">filter_cutoff</span> <span class="kw">=</span> <span class="fl">0.06</span>
  ,<span class="kw">fill_reverse</span> <span class="kw">=</span> <span class="fl">FALSE</span>
)</pre></body></html></div>
<div class="figure">
<img src="wiesbaden_files/figure-html/21311LS001A-plot3-1.png" alt="Students at the five biggest universities in NRW from 2013 to 2018 for each degree (Vertical stacked bar chart scaled to 100 percent)" width="700.0000032"><p class="caption">
Students at the five biggest universities in NRW from 2013 to 2018 for each degree (Vertical stacked bar chart scaled to 100 percent)
</p>
</div>
</div>
<div id="data-license-for-the-destatis-data" class="section level1">
<h1 class="hasAnchor">
<a href="#data-license-for-the-destatis-data" class="anchor"></a>Data license for the Destatis data</h1>
<p>Data obtained from Destatis is available under the <a href="www.govdata.de/dl-de/by-2-0">Data licence Germany – attribution – version 2.0 (dl-de/by-2-0)</a>. The data in this vignette was obtained from the Landesdatenbank NRW using the code “213” for “Hochschulen”. The license requests a reference to the dataset using the URI. To the best of my knowledge, the Landesdatenbank NRW does not yet provide Uniform Resource Identifiers (URI) to identify these tables.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Richard Meyer-Eppler.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
